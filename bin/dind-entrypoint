#!/usr/bin/env sh

function setup_ssh() {
    mkdir -p /root/.ssh &&
        echo -n "${AUTHORIZED_KEYS}" > /root/.ssh/authorized_keys &&
        chmod 600 /root/.ssh/authorized_keys
}

function setup_cwd() {
    echo "${CURRENT_DIR_NAME}" > /tmp/cwd
}

trap 'rc-service sshd stop' EXIT

setup_cwd &&
    setup_ssh &&
    rc-status &&
    rc-service sshd start &&
    tail -f /dev/null
